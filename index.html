<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Van Stock & Reception Prototype</title>
  <style>
    :root{
      --bg:#f4f6f8; --card:#ffffff; --muted:#6b7280; --accent:#0b69ff;
      --success:#16a34a; --warning:#f59e0b; --danger:#ef4444; --info:#0284c7;
      --purple:#7c3aed; --chip-bg:#eef2ff;
      font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#0f172a;-webkit-font-smoothing:antialiased}
    .app{max-width:980px;margin:18px auto;padding:18px;}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .title {font-size:20px;font-weight:700}
    .meta{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .btn.secondary{background:#fff;border:1px solid #e6eefc;color:var(--muted);font-weight:600}
    .tabs{display:flex;gap:8px;margin:12px 0}
    .tab{padding:10px 14px;background:var(--card);border-radius:10px;cursor:pointer;border:1px solid transparent;font-weight:600}
    .tab.active{border-color:#c7d2fe;background:linear-gradient(180deg,#fbfdff,#f7f9ff)}
    .cards{display:flex;gap:10px;margin:10px 0 20px;flex-wrap:wrap}
    .card{background:var(--card);padding:12px;border-radius:10px;flex:1;min-width:180px;box-shadow:0 1px 2px rgba(15,23,42,0.04)}
    .list{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 1px 2px rgba(15,23,42,0.04)}
    .row{display:flex;align-items:center;gap:12px;padding:14px;border-bottom:1px solid #f1f5f9}
    .row:last-child{border-bottom:none}
    .part-id{font-weight:700;font-size:16px;color:#0b2545}
    .desc{color:#334155;font-size:14px}
    .small{font-size:13px;color:var(--muted)}
    .badge{padding:6px 10px;border-radius:999px;color:white;font-weight:700;font-size:13px;display:inline-block}
    .status-available{background:var(--success)}
    .status-onhand{background:var(--info)}
    .status-allocated{background:var(--warning);color:#111}
    .status-reserved{background:var(--purple)}
    .status-onorder{background:#64748b}
    .eta-badge{padding:6px 8px;border-radius:8px;color:white;font-weight:700}
    .eta-soon{background:var(--warning);color:#111} .eta-ok{background:var(--info)} .eta-overdue{background:var(--danger)}
    .link{color:var(--accent);text-decoration:none;cursor:pointer;font-weight:600}
    .action{padding:6px 8px;border-radius:8px;border:1px solid #e6eefc;background:#fff;cursor:pointer;font-size:13px}
    .panel-title{font-weight:800;margin-bottom:8px;font-size:18px}
    .modal-overlay{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(2,6,23,0.55);display:flex;align-items:center;justify-content:center;z-index:999}
    .modal{width:92%;max-width:720px;background:#fff;border-radius:10px;padding:18px;max-height:86vh;overflow:auto;box-shadow:0 10px 30px rgba(2,6,23,0.2)}
    input, textarea, select{padding:10px;border-radius:8px;border:1px solid #e6eefc;font-size:14px;width:100%;font-family:inherit}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:720px){.grid{grid-template-columns:1fr}}
    footer{margin-top:18px;font-size:13px;color:var(--muted);text-align:center}
    .muted-block{color:var(--muted);font-size:13px;margin-top:6px}
    .inline{display:flex;gap:8px;align-items:center}
    .value-chip{background:var(--chip-bg);padding:6px 10px;border-radius:8px;font-weight:700;color:var(--info);font-size:13px}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div>
        <div class="title">Van Stock & Reception</div>
        <div class="meta">Technician: T1 • Location: Berlin</div>
      </div>
      <div class="controls">
        <div class="meta" id="lastSync">Last sync: —</div>
        <button class="btn" id="syncBtn">Sync</button>
        <button class="btn secondary" id="resetBtn">Reset</button>
      </div>
    </header>

    <div class="tabs" role="tablist">
      <div class="tab active" data-tab="van" id="tabVan">Van Stock</div>
      <div class="tab" data-tab="reception" id="tabRec">Reception</div>
    </div>

    <main id="content">
      <section id="view-van">
        <div class="list" style="margin-bottom:12px;display:flex;gap:12px;align-items:center;">
          <input id="searchInput" type="text" placeholder="Search Part ID or Description" style="flex:1" />
          <select id="filterSelect" style="width:160px">
            <option value="all">All</option>
            <option value="available">Available</option>
            <option value="onhand">On Hand</option>
            <option value="allocated">Allocated</option>
            <option value="onorder">On Order</option>
          </select>
        </div>

        <div class="list" id="vanList" aria-live="polite"></div>
      </section>

      <section id="view-reception" style="display:none;">
        <div class="list" style="margin-bottom:12px;padding:12px;">
          <div style="display:flex;gap:8px;align-items:center;">
            <input type="text" id="boxInput" placeholder="Enter or scan Box ID (e.g. BOX123)" />
            <button class="btn" id="fetchBox">Confirm Box</button>
            <div style="margin-left:auto" class="small muted">Box ID required to open contents</div>
          </div>
        </div>
        <div id="boxArea" class="list"><div class="muted-block">Confirm a Box ID to open a popup with box contents.</div></div>
      </section>
    </main>

    <footer>Prototype (Dynamics 365 Field Service Mobile compatible UI controls)</footer>
  </div>

  <div id="modalRoot" style="display:none;"></div>
  <div id="toast" style="display:none;position:fixed;right:16px;bottom:16px;background:#0f172a;color:#fff;padding:12px;border-radius:8px;"></div>

<script>
/* Updated prototype per request:
   - Part details open as popup modal (overlay)
   - Part row simplified (no labels) and improved typography/colors
   - Reception: after box confirm, contents open in modal popup
   - Removed "Requested: X • Delivered: Y" display (per requirement)
   - Kept core behaviors: manual add, missing/damage (photo required), receive flow
*/

const SAMPLE = {
  technician_id: "T1",
  parts: [
    { part_id:"00248240", description:"Cable", breakdown:{available:2,on_hand:1,allocated:0}, on_orders:[{order_id:"O-1001",outstanding_qty:1,eta:"2026-06-22",source:"REPLENISH"}], price:{amount:12.5,currency:"EUR",incl_vat:true}, status:"ON_HAND", linked_WOs:[{wo_id:"WO123",booking_date:"2026-06-01"}]},
    { part_id:"0008045", description:"Motor", breakdown:{available:0,on_hand:0,allocated:1}, on_orders:[], price:{amount:85.0,currency:"EUR",incl_vat:true}, status:"ALLOCATED", linked_WOs:[{wo_id:"WO200",booking_date:"2026-06-03"}]},
    { part_id:"00169216", description:"Fan", breakdown:{available:1,on_hand:0,allocated:0}, on_orders:[{order_id:"O-2002",outstanding_qty:2,eta:"2026-06-27",source:"REPLENISH"}], price:{amount:45.0,currency:"EUR",incl_vat:true}, status:"AVAILABLE", linked_WOs:[]}
  ],
  boxes: [
    { box_id:"BOX123", shipment_date:"2026-06-01T07:30:00Z", delivered_by:"WH-DE", status:"UNCONFIRMED", items:[
      { part_id:"00248240", description:"Cable", wo_id:"WO123", requested_qty:1, delivered_qty:1 },
      { part_id:"00169216", description:"Fan", wo_id:"WO124", requested_qty:1, delivered_qty:0 },
      { part_id:"P-UNKNOWN", description:"Unknown extra", wo_id:null, requested_qty:0, delivered_qty:1 }
    ] }
  ],
  pending: [],
  exceptions: []
};

const LS_KEY = "van_v6";
function loadState(){ const raw=localStorage.getItem(LS_KEY); if(raw) return JSON.parse(raw); localStorage.setItem(LS_KEY,JSON.stringify(SAMPLE)); return JSON.parse(localStorage.getItem(LS_KEY)); }
function saveState(s){ localStorage.setItem(LS_KEY,JSON.stringify(s)); }

let state = loadState();

function render(){
  document.getElementById('lastSync').innerText = "Last sync: " + (localStorage.getItem('lastSync') || '—');
  renderVanList();
  renderBoxMessage();
}
function renderVanList(){
  const container = document.getElementById('vanList'); container.innerHTML='';
  const q = document.getElementById('searchInput').value.trim().toLowerCase();
  const filter = document.getElementById('filterSelect').value;
  state.parts.forEach(p=>{
    if(q && !(p.part_id.toLowerCase().includes(q) || p.description.toLowerCase().includes(q))) return;
    if(filter==='available' && p.breakdown.available<=0) return;
    if(filter==='onhand' && p.breakdown.on_hand<=0) return;
    if(filter==='allocated' && p.breakdown.allocated<=0) return;
    if(filter==='onorder' && (!p.on_orders || p.on_orders.length===0)) return;
    const row = document.createElement('div'); row.className='row'; row.style.alignItems='center';
    row.innerHTML = `
      <div style="flex:0 0 360px;">
        <div class="part-id">${p.part_id}</div>
        <div class="desc">${p.description}</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="value-chip" title="Available">${p.breakdown.available}</div>
        <div class="value-chip" title="On Hand">${p.breakdown.on_hand}</div>
        <div class="value-chip" title="Allocated">${p.breakdown.allocated}</div>
        <div style="min-width:120px">${ renderOnOrderCompact(p) }</div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div style="margin-bottom:6px">${renderStatus(p)}</div>
        <div><a class="link" data-id="${p.part_id}">Details</a></div>
      </div>`;
    container.appendChild(row);
  });
  container.querySelectorAll('.link').forEach(a=>a.addEventListener('click', ()=> openPartDetail(a.getAttribute('data-id'))));
}

function renderOnOrderCompact(p){
  const totalOnOrder = (p.on_orders||[]).reduce((a,o)=>a+o.outstanding_qty,0);
  if(totalOnOrder===0) return '';
  const sorted = (p.on_orders||[]).slice().sort((a,b)=> new Date(a.eta)-new Date(b.eta));
  const first = sorted[0];
  const second = sorted[1];
  let html = `<div style="font-size:13px;color:#0b2545"><strong>On Order:</strong> ${totalOnOrder}</div>`;
  html += `<div class="small muted">${formatDate(first.eta)} (${first.outstanding_qty})${second? ' • '+formatDate(second.eta)+' ('+second.outstanding_qty+')':''}${p.on_orders.length>2? ' • +'+(p.on_orders.length-2)+' more':''}</div>`;
  return html;
}

function renderStatus(p){
  if(p.status==='AVAILABLE') return `<span class="badge status-available">Available</span>`;
  if(p.status==='ON_HAND') return `<span class="badge status-onhand">On Hand</span>`;
  if(p.status==='ALLOCATED') return `<span class="badge status-allocated">Allocated</span>`;
  if(p.status==='VAN_RESERVED') return `<span class="badge status-reserved">Van reserved</span>`;
  return `<span class="badge status-onorder">On Order</span>`;
}

function openPartDetail(partId){
  const p = state.parts.find(x=>x.part_id===partId); if(!p) return alert('Not found');
  const root = document.getElementById('modalRoot'); root.innerHTML = '';
  const overlay = document.createElement('div'); overlay.className='modal-overlay';
  const modal = document.createElement('div'); modal.className='modal';
  let html = `<div class="panel-title">${p.part_id} — ${p.description}</div>`;
  html += `<div style="display:grid;gap:12px">`;
  html += `<div><strong>Available</strong><div class="small">${p.breakdown.available}</div>`;
  if(p.linked_WOs && p.linked_WOs.length>0) html += `<div class="small muted">Linked WOs: ${p.linked_WOs.map(w=>w.wo_id+' ('+w.booking_date+')').join(', ')}</div>`;
  html += `</div>`;
  html += `<div><strong>On Hand</strong><div class="small">${p.breakdown.on_hand}</div>`;
  if(p.linked_WOs && p.linked_WOs.length>0) html += `<div class="small muted">Linked WOs: ${p.linked_WOs.map(w=>w.wo_id+' ('+w.booking_date+')').join(', ')}</div>`;
  else html += `<div class="small muted">Received via Reception (no linked Work Order)</div>`;
  html += `</div>`;
  html += `<div><strong>Allocated</strong><div class="small">${p.breakdown.allocated}</div>`;
  if(p.status==='ALLOCATED' && p.linked_WOs && p.linked_WOs.length>0) html += `<div class="small muted">Allocated to: ${p.linked_WOs.map(w=>w.wo_id+' ('+w.booking_date+')').join(', ')}</div>`;
  html += `</div>`;
  html += `<div><strong>On Order</strong>`;
  if(p.on_orders && p.on_orders.length>0){
    html += `<table style="width:100%;border-collapse:collapse;margin-top:6px"><thead><tr><th style="text-align:left">Order</th><th style="text-align:left">Outstanding</th><th style="text-align:left">ETA</th><th style="text-align:left">Source</th></tr></thead><tbody>`;
    p.on_orders.slice().sort((a,b)=>new Date(a.eta)-new Date(b.eta)).forEach(o=>{ html += `<tr><td>${o.order_id}</td><td>${o.outstanding_qty}</td><td>${formatDate(o.eta)}</td><td>${o.source}</td></tr>`; });
    html += `</tbody></table>`;
  } else html += `<div class="small muted">No on orders</div>`;
  html += `</div></div>`;
  html += `<div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button class="btn" id="closeDetail">Close</button>${ p.breakdown.on_hand>0 ? '<button class="btn secondary" id="openReception">Open Reception</button>' : ''}</div>`;
  modal.innerHTML = html; overlay.appendChild(modal); root.appendChild(overlay); root.style.display='block';
  document.getElementById('closeDetail').addEventListener('click', ()=>{ root.style.display='none'; root.innerHTML=''; });
  const rbtn = document.getElementById('openReception'); if(rbtn) rbtn.addEventListener('click', ()=>{ root.style.display='none'; root.innerHTML=''; switchTab('reception'); document.getElementById('boxInput').focus(); });
}

function renderBoxMessage(){ const el=document.getElementById('boxArea'); el.innerHTML = '<div class="muted-block">Enter Box ID and confirm to open contents in a popup.</div>'; }

/* Reception logic */
document.getElementById('fetchBox').addEventListener('click', ()=>{
  const id = document.getElementById('boxInput').value.trim(); if(!id) return alert('Enter Box ID');
  const box = state.boxes.find(b=>b.box_id===id); if(!box) return alert('Box not found (demo)');
  openBoxModal(id);
});

function openBoxModal(boxId){
  const box = state.boxes.find(b=>b.box_id===boxId); if(!box) return;
  const root = document.getElementById('modalRoot'); root.innerHTML='';
  const overlay = document.createElement('div'); overlay.className='modal-overlay';
  const modal = document.createElement('div'); modal.className='modal';
  let html = `<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:800">${box.box_id}</div><div class="small muted">${box.delivered_by} • ${new Date(box.shipment_date).toLocaleString()}</div></div><div><button class="action" id="closeBoxModal">Close</button></div></div>`;
  html += `<div id="boxItemsArea" style="margin-top:12px"></div>`;
  html += `<div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button class="btn" id="submitBox">Submit</button><button class="btn secondary" id="manualAddBtn">Add manual item</button></div>`;
  modal.innerHTML = html; overlay.appendChild(modal); root.appendChild(overlay); root.style.display='block';
  document.getElementById('closeBoxModal').addEventListener('click', ()=>{ root.style.display='none'; root.innerHTML=''; });
  document.getElementById('manualAddBtn').addEventListener('click', ()=> showManualAddModal(box.box_id));
  renderBoxItemsInModal(box);
  document.getElementById('submitBox').addEventListener('click', ()=> { submitBox(box.box_id); root.style.display='none'; root.innerHTML=''; });
}

function renderBoxItemsInModal(box){
  const area = document.getElementById('boxItemsArea'); area.innerHTML='';
  box.items.forEach((it, idx)=>{
    const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.padding='10px 0'; row.style.borderBottom='1px solid #f1f5f9';
    row.innerHTML = `<div>
        <div class="part-id">${it.part_id}${it.manual? ' • Manual':''}</div>
        <div class="desc">${it.description}</div>
        ${ it.wo_id ? `<div class="small muted">WO: ${it.wo_id}</div>` : `<div class="small muted">No linked Work Order</div>`}
      </div>
      <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
        <div class="inline"><label><input type="checkbox" data-idx="${idx}" class="missingChk"> Missing</label></div>
        <div class="inline"><label><input type="checkbox" data-idx="${idx}" class="damageChk"> Damaged</label></div>
        <div style="display:none" id="photoArea-${idx}"><input type="text" id="photoInput-${idx}" placeholder="Photo URL (demo)"></div>
      </div>`;
    area.appendChild(row);
  });
  area.querySelectorAll('.damageChk').forEach(chk=> chk.addEventListener('change', (e)=>{ const idx=e.target.getAttribute('data-idx'); document.getElementById('photoArea-'+idx).style.display = e.target.checked ? 'block':'none'; }));
  // missing checkbox has two-step confirmation on submit path
}

/* Manual add modal */
function showManualAddModal(box_id){
  const root = document.getElementById('modalRoot'); root.innerHTML='';
  const overlay = document.createElement('div'); overlay.className='modal-overlay';
  const modal = document.createElement('div'); modal.className='modal';
  modal.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div class="panel-title">Add manual item to ${box_id}</div><div><button class="action" id="closeManual">Close</button></div></div>
    <div style="display:grid;gap:8px;margin-top:8px"><input id="m_part" placeholder="Part ID (scan or type)"><input id="m_desc" placeholder="Description (optional)"><input id="m_qty" type="number" value="1"><textarea id="m_note" placeholder="Note (optional)"></textarea>
    <div style="display:flex;gap:8px;justify-content:flex-end"><button class="btn" id="m_add">Add</button><button class="btn secondary" id="m_cancel">Cancel</button></div></div>`;
  overlay.appendChild(modal); root.appendChild(overlay); root.style.display='block';
  document.getElementById('closeManual').addEventListener('click', ()=>{ root.style.display='none'; root.innerHTML=''; });
  document.getElementById('m_cancel').addEventListener('click', ()=>{ root.style.display='none'; root.innerHTML=''; });
  document.getElementById('m_add').addEventListener('click', ()=>{
    const pid=document.getElementById('m_part').value.trim(); if(!pid) return alert('Part ID required');
    const desc=document.getElementById('m_desc').value.trim()||'(manual)'; const qty=parseInt(document.getElementById('m_qty').value||'1',10); const note=document.getElementById('m_note').value.trim();
    const box = state.boxes.find(b=>b.box_id===box_id); if(!box) return alert('Box missing');
    box.items.push({part_id:pid, description:desc, wo_id:null, requested_qty:0, delivered_qty:qty, manual:true});
    const ex={id:'EX-'+Date.now(), type:'MANUAL_ADD', part_id:pid, qty, note, box_id, technician:state.technician_id, ts:new Date().toISOString()};
    state.exceptions.push(ex); state.pending.push({type:'MANUAL_ADD', ex});
    saveState(state); root.style.display='none'; root.innerHTML=''; openBoxModal(box_id);
  });
}

/* Submit - validate damaged photos and missing confirmation */
function submitBox(box_id){
  const box = state.boxes.find(b=>b.box_id===box_id); if(!box) return;
  const area = document.getElementById('boxItemsArea'); const items = box.items;
  // Check damaged photo requirement
  for(let i=0;i<items.length;i++){
    const damageChk = area.querySelector(`input.damageChk[data-idx="${i}"]`);
    if(damageChk && damageChk.checked){
      const photoVal = document.getElementById('photoInput-'+i).value.trim();
      if(!photoVal){ alert('Please attach a photo for damaged items'); return; }
    }
  }
  // Confirm missing items two-step
  const missingIdxs = [];
  for(let i=0;i<items.length;i++){
    const missChk = area.querySelector(`input.missingChk[data-idx="${i}"]`);
    if(missChk && missChk.checked) missingIdxs.push(i);
  }
  if(missingIdxs.length>0){
    const confirm1 = confirm('You have marked one or more items as Missing. Do you want to continue to confirmation?');
    if(!confirm1) return;
    const confirm2 = confirm('Confirm Missing items: this will create Missing reports and notify Warehouse. Proceed?');
    if(!confirm2) return;
  }
  // Build payload (simplified)
  const payload = { box_id:box.box_id, technician_id:state.technician_id, items:[] };
  items.forEach((it, idx)=>{
    const missChk = area.querySelector(`input.missingChk[data-idx="${idx}"]`);
    const dmgChk = area.querySelector(`input.damageChk[data-idx="${idx}"]`);
    const photoVal = document.getElementById('photoInput-'+idx) ? document.getElementById('photoInput-'+idx).value.trim() : '';
    if(dmgChk && dmgChk.checked){
      payload.items.push({ part_id:it.part_id, action:'DAMAGED', photos:[photoVal], manual_entry:!!it.manual });
      state.exceptions.push({id:'D-'+Date.now(), type:'DAMAGED', part_id:it.part_id, box_id:box.box_id, photo:photoVal, technician:state.technician_id, ts:new Date().toISOString()});
    } else if(missChk && missChk.checked){
      payload.items.push({ part_id:it.part_id, action:'MISSING', manual_entry:!!it.manual });
      state.exceptions.push({id:'M-'+Date.now(), type:'MISSING', part_id:it.part_id, box_id:box.box_id, technician:state.technician_id, ts:new Date().toISOString()});
    } else {
      payload.items.push({ part_id:it.part_id, action:'RECEIVED', manual_entry:!!it.manual });
      // update local van stock
      let part = state.parts.find(p=>p.part_id===it.part_id);
      if(!part){ part = { part_id:it.part_id, description:it.description||'(manual)', breakdown:{available:0,on_hand:0,allocated:0}, on_orders:[], price:{amount:0,currency:'EUR',incl_vat:true}, status:'ON_HAND' }; state.parts.push(part); }
      part.breakdown.on_hand = (part.breakdown.on_hand||0) + it.delivered_qty;
      part.breakdown.available = (part.breakdown.available||0) + it.delivered_qty;
      part.status = 'ON_HAND';
    }
  });
  state.pending.push({type:'DELIVERY_CONFIRM', payload, ts:new Date().toISOString()});
  // mark box confirmed
  box.status='CONFIRMED'; saveState(state); showToast('Box submitted (queued)'); render();
}

/* Sync */
document.getElementById('syncBtn').addEventListener('click', ()=>{
  if(!(state.pending && state.pending.length>0)){ localStorage.setItem('lastSync', new Date().toLocaleString()); render(); showToast('Already synced'); return; }
  showToast('Syncing...'); setTimeout(()=>{ state.pending=[]; localStorage.setItem('lastSync', new Date().toLocaleString()); saveState(state); render(); showToast('Sync complete'); },900);
});
document.getElementById('resetBtn').addEventListener('click', ()=>{ if(!confirm('Reset demo?')) return; localStorage.removeItem(LS_KEY); state=loadState(); render(); });

/* Tabs and inputs */
function switchTab(tab){ document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); document.querySelector(`.tab[data-tab="${tab}"]`).classList.add('active'); document.getElementById('view-van').style.display = tab==='van' ? '' : 'none'; document.getElementById('view-reception').style.display = tab==='reception' ? '' : 'none'; }
document.getElementById('tabVan').addEventListener('click', ()=> switchTab('van'));
document.getElementById('tabRec').addEventListener('click', ()=> switchTab('reception'));
document.getElementById('searchInput').addEventListener('input', renderVanList);
document.getElementById('filterSelect').addEventListener('change', renderVanList);

function formatDate(d){ if(!d) return ''; const dt=new Date(d); return dt.toLocaleDateString(); }
function showToast(msg){ const t=document.getElementById('toast'); t.innerText=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2000); }

render();
</script>
</body>
</html>
